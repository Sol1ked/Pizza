{"ast":null,"code":"import _objectSpread from\"C:/Users/aprim/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/pizza/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"C:/Users/aprim/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/pizza/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"C:/Users/aprim/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/pizza/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/aprim/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/pizza/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/aprim/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/pizza/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useCallback,useEffect,useRef}from'react';import{useNavigate,useSearchParams}from'react-router-dom';import Categories from'../components/Categories';import Sort from'../components/Sort';import PizzaBlock from'../components/PizzaBlock';import Skeleton from'../components/PizzaBlock/Skeleton';import Pagination from'../components/Pagination';import{useSelector}from'react-redux';import{useAppDispatch}from'../redux/store';import{setCategoryId,setCurrentPage}from'../redux/filter/slice';import{fetchPizzas}from'../redux/pizza/asyncActions';import{selectFilter}from'../redux/filter/selectors';import{selectPizzaData}from'../redux/pizza/selectors';import{jsx as _jsx}from\"react/jsx-runtime\";import{createElement as _createElement}from\"react\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Home=function Home(){var navigate=useNavigate();var dispatch=useAppDispatch();var _useSelector=useSelector(selectFilter),categoryId=_useSelector.categoryId,sort=_useSelector.sort,currentPage=_useSelector.currentPage,searchValue=_useSelector.searchValue;var _useSelector2=useSelector(selectPizzaData),items=_useSelector2.items,status=_useSelector2.status;var _useSearchParams=useSearchParams(),_useSearchParams2=_slicedToArray(_useSearchParams,2),searchParams=_useSearchParams2[0],setSearchParams=_useSearchParams2[1];var isChangeSearchParam=useRef(false);var isFirstMount=useRef(false);var onChangeCategory=useCallback(function(id){dispatch(setCategoryId(id));},[]);var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var url,replaceSortType,replaceSortTypeFirstSymbol,categorySort,searchParam;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:url='https://650ec8a054d18aabfe9976df.mockapi.io/items';replaceSortType=sort.type.replace('+','');replaceSortTypeFirstSymbol=sort.type.includes('+')?'asc':'desc';categorySort=categoryId>0?\"category=\".concat(categoryId):'';searchParam=searchValue?\"&search=\".concat(searchValue):'';//добавил параметр для поиска\n//TODO - переделать выпадающий список в сортировке, добавить икони вверх вниз, вместо строчек\ndispatch(fetchPizzas({url:url,currentPage:currentPage,categorySort:categorySort,replaceSortType:replaceSortType,replaceSortTypeFirstSymbol:replaceSortTypeFirstSymbol,searchParam:searchParam}));case 6:case\"end\":return _context.stop();}},_callee);}));return function fetchData(){return _ref.apply(this,arguments);};}();// useEffect(() => {\n//   if (searchParams.size > 0) {\n//     const urlParams = qs.parse(searchParams.toString());\n//     const sort = sortItems.find((obj) => obj.type === urlParams.sortType);\n//     dispatch(\n//       setFiltersParams({\n//         ...urlParams,\n//         sort: sort || sortItems[0],\n//       }),\n//     );\n//     isChangeSearchParam.current = true;\n//   }\n// }, []);\n// useEffect(() => {\n//   if (isFirstMount.current) {\n//     const queryString = qs.stringify({\n//       sortType: sort.type,\n//       categoryId,\n//       currentPage,\n//     });\n//     navigate(`?${queryString}`);\n//   }\n//   isFirstMount.current = true;\n// }, [categoryId, sort.type, searchValue, currentPage]);\nuseEffect(function(){if(!isChangeSearchParam.current){fetchData();}isChangeSearchParam.current=false;},[categoryId,sort.type,searchValue,currentPage]);var skeletons=_toConsumableArray(new Array(4)).map(function(_,index){return/*#__PURE__*/_jsx(Skeleton,{},index);});var pizzas=items.map(function(item){return/*#__PURE__*/_createElement(PizzaBlock,_objectSpread(_objectSpread({sizes:[],types:[]},item),{},{key:item.id}));});return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"content__top\",children:[/*#__PURE__*/_jsx(Categories,{categoryId:categoryId,onChangeCategory:onChangeCategory}),/*#__PURE__*/_jsx(Sort,{value:sort})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"content__title\",children:\"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"}),status==='error'?/*#__PURE__*/_jsxs(\"div\",{className:\"content__error-info\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u041F\\u0440\\u043E\\u0438\\u0437\\u043E\\u0448\\u043B\\u0430 \\u043E\\u0448\\u0438\\u0431\\u043A\\u0430 :/\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u041D\\u0435 \\u0443\\u0434\\u0430\\u043B\\u043E\\u0441\\u044C \\u043F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043F\\u0438\\u0442\\u0441\\u044B\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"content__items\",children:status==='loading'?skeletons:/*#__PURE__*/_jsx(_Fragment,{children:pizzas.length?pizzas:/*#__PURE__*/_jsx(\"p\",{style:{marginBottom:'8px'},children:\"\\u041F\\u043E \\u0432\\u0430\\u0448\\u0435\\u043C\\u0443 \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441\\u0443 \\u043D\\u0438\\u0447\\u0435\\u0433\\u043E \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D\\u043E\"})})}),/*#__PURE__*/_jsx(Pagination,{forcePage:Number(currentPage),onPageChange:function onPageChange(number){return dispatch(setCurrentPage(number));}})]});};export default Home;","map":{"version":3,"names":["React","useCallback","useEffect","useRef","useNavigate","useSearchParams","Categories","Sort","PizzaBlock","Skeleton","Pagination","useSelector","useAppDispatch","setCategoryId","setCurrentPage","fetchPizzas","selectFilter","selectPizzaData","jsx","_jsx","createElement","_createElement","jsxs","_jsxs","Fragment","_Fragment","Home","navigate","dispatch","_useSelector","categoryId","sort","currentPage","searchValue","_useSelector2","items","status","_useSearchParams","_useSearchParams2","_slicedToArray","searchParams","setSearchParams","isChangeSearchParam","isFirstMount","onChangeCategory","id","fetchData","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","url","replaceSortType","replaceSortTypeFirstSymbol","categorySort","searchParam","wrap","_callee$","_context","prev","next","type","replace","includes","concat","stop","apply","arguments","current","skeletons","_toConsumableArray","Array","map","_","index","pizzas","item","_objectSpread","sizes","types","key","className","children","value","length","style","marginBottom","forcePage","Number","onPageChange","number"],"sources":["C:/Users/aprim/Рабочий стол/pizza/src/pages/Home.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\n\r\nimport Categories from '../components/Categories';\r\nimport Sort from '../components/Sort';\r\nimport PizzaBlock from '../components/PizzaBlock';\r\nimport Skeleton from '../components/PizzaBlock/Skeleton';\r\nimport Pagination from '../components/Pagination';\r\n\r\nimport { useSelector } from 'react-redux';\r\nimport { useAppDispatch } from '../redux/store';\r\n\r\nimport { setCategoryId, setCurrentPage } from '../redux/filter/slice';\r\nimport { fetchPizzas } from '../redux/pizza/asyncActions';\r\n\r\nimport qs from 'qs';\r\nimport { selectFilter } from '../redux/filter/selectors';\r\nimport { selectPizzaData } from '../redux/pizza/selectors';\r\n\r\nconst Home: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const dispatch = useAppDispatch();\r\n  const { categoryId, sort, currentPage, searchValue } = useSelector(selectFilter);\r\n  const { items, status } = useSelector(selectPizzaData);\r\n\r\n  const [searchParams, setSearchParams] = useSearchParams();\r\n  const isChangeSearchParam = useRef(false);\r\n  const isFirstMount = useRef(false);\r\n\r\n  const onChangeCategory = useCallback((id: number) => {\r\n    dispatch(setCategoryId(id));\r\n  }, []);\r\n\r\n  const fetchData = async () => {\r\n    const url = 'https://650ec8a054d18aabfe9976df.mockapi.io/items';\r\n    const replaceSortType = sort.type.replace('+', '');\r\n    const replaceSortTypeFirstSymbol = sort.type.includes('+') ? 'asc' : 'desc';\r\n    const categorySort = categoryId > 0 ? `category=${categoryId}` : '';\r\n    const searchParam = searchValue ? `&search=${searchValue}` : ''; //добавил параметр для поиска\r\n    //TODO - переделать выпадающий список в сортировке, добавить икони вверх вниз, вместо строчек\r\n    dispatch(\r\n      fetchPizzas({\r\n        url,\r\n        currentPage,\r\n        categorySort,\r\n        replaceSortType,\r\n        replaceSortTypeFirstSymbol,\r\n        searchParam,\r\n      }),\r\n    );\r\n  };\r\n\r\n  // useEffect(() => {\r\n  //   if (searchParams.size > 0) {\r\n  //     const urlParams = qs.parse(searchParams.toString());\r\n  //     const sort = sortItems.find((obj) => obj.type === urlParams.sortType);\r\n\r\n  //     dispatch(\r\n  //       setFiltersParams({\r\n  //         ...urlParams,\r\n  //         sort: sort || sortItems[0],\r\n  //       }),\r\n  //     );\r\n  //     isChangeSearchParam.current = true;\r\n  //   }\r\n  // }, []);\r\n\r\n  // useEffect(() => {\r\n  //   if (isFirstMount.current) {\r\n  //     const queryString = qs.stringify({\r\n  //       sortType: sort.type,\r\n  //       categoryId,\r\n  //       currentPage,\r\n  //     });\r\n  //     navigate(`?${queryString}`);\r\n  //   }\r\n  //   isFirstMount.current = true;\r\n  // }, [categoryId, sort.type, searchValue, currentPage]);\r\n\r\n  useEffect(() => {\r\n    if (!isChangeSearchParam.current) {\r\n      fetchData();\r\n    }\r\n    isChangeSearchParam.current = false;\r\n  }, [categoryId, sort.type, searchValue, currentPage]);\r\n\r\n  const skeletons = [...new Array(4)].map((_, index) => <Skeleton key={index} />);\r\n  const pizzas = items.map((item) => <PizzaBlock sizes={[]} types={[]} {...item} key={item.id} />);\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"content__top\">\r\n        <Categories categoryId={categoryId} onChangeCategory={onChangeCategory} />\r\n        <Sort value={sort} />\r\n      </div>\r\n      <h2 className=\"content__title\">Все пиццы</h2>\r\n      {status === 'error' ? (\r\n        <div className=\"content__error-info\">\r\n          <h2>Произошла ошибка :/</h2>\r\n          <p>Не удалось получить питсы</p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"content__items\">\r\n          {status === 'loading' ? (\r\n            skeletons\r\n          ) : (\r\n            <>\r\n              {pizzas.length ? (\r\n                pizzas\r\n              ) : (\r\n                <p style={{ marginBottom: '8px' }}>По вашему запросу ничего не найдено</p>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      )}\r\n      <Pagination\r\n        forcePage={Number(currentPage)}\r\n        onPageChange={(number) => dispatch(setCurrentPage(number))}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"],"mappings":"63BAAA,MAAO,CAAAA,KAAK,EAAIC,WAAW,CAAEC,SAAS,CAAEC,MAAM,KAAkB,OAAO,CACvE,OAASC,WAAW,CAAEC,eAAe,KAAQ,kBAAkB,CAE/D,MAAO,CAAAC,UAAU,KAAM,0BAA0B,CACjD,MAAO,CAAAC,IAAI,KAAM,oBAAoB,CACrC,MAAO,CAAAC,UAAU,KAAM,0BAA0B,CACjD,MAAO,CAAAC,QAAQ,KAAM,mCAAmC,CACxD,MAAO,CAAAC,UAAU,KAAM,0BAA0B,CAEjD,OAASC,WAAW,KAAQ,aAAa,CACzC,OAASC,cAAc,KAAQ,gBAAgB,CAE/C,OAASC,aAAa,CAAEC,cAAc,KAAQ,uBAAuB,CACrE,OAASC,WAAW,KAAQ,6BAA6B,CAGzD,OAASC,YAAY,KAAQ,2BAA2B,CACxD,OAASC,eAAe,KAAQ,0BAA0B,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,aAAA,IAAAC,cAAA,oBAAAC,IAAA,IAAAC,KAAA,gCAAAC,QAAA,IAAAC,SAAA,yBAE3D,GAAM,CAAAC,IAAc,CAAG,QAAjB,CAAAA,IAAcA,CAAA,CAAS,CAC3B,GAAM,CAAAC,QAAQ,CAAGvB,WAAW,CAAC,CAAC,CAC9B,GAAM,CAAAwB,QAAQ,CAAGhB,cAAc,CAAC,CAAC,CACjC,IAAAiB,YAAA,CAAuDlB,WAAW,CAACK,YAAY,CAAC,CAAxEc,UAAU,CAAAD,YAAA,CAAVC,UAAU,CAAEC,IAAI,CAAAF,YAAA,CAAJE,IAAI,CAAEC,WAAW,CAAAH,YAAA,CAAXG,WAAW,CAAEC,WAAW,CAAAJ,YAAA,CAAXI,WAAW,CAClD,IAAAC,aAAA,CAA0BvB,WAAW,CAACM,eAAe,CAAC,CAA9CkB,KAAK,CAAAD,aAAA,CAALC,KAAK,CAAEC,MAAM,CAAAF,aAAA,CAANE,MAAM,CAErB,IAAAC,gBAAA,CAAwChC,eAAe,CAAC,CAAC,CAAAiC,iBAAA,CAAAC,cAAA,CAAAF,gBAAA,IAAlDG,YAAY,CAAAF,iBAAA,IAAEG,eAAe,CAAAH,iBAAA,IACpC,GAAM,CAAAI,mBAAmB,CAAGvC,MAAM,CAAC,KAAK,CAAC,CACzC,GAAM,CAAAwC,YAAY,CAAGxC,MAAM,CAAC,KAAK,CAAC,CAElC,GAAM,CAAAyC,gBAAgB,CAAG3C,WAAW,CAAC,SAAC4C,EAAU,CAAK,CACnDjB,QAAQ,CAACf,aAAa,CAACgC,EAAE,CAAC,CAAC,CAC7B,CAAC,CAAE,EAAE,CAAC,CAEN,GAAM,CAAAC,SAAS,6BAAAC,IAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAA,MAAAC,GAAA,CAAAC,eAAA,CAAAC,0BAAA,CAAAC,YAAA,CAAAC,WAAA,QAAAP,mBAAA,GAAAQ,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SACVT,GAAG,CAAG,mDAAmD,CACzDC,eAAe,CAAGtB,IAAI,CAAC+B,IAAI,CAACC,OAAO,CAAC,GAAG,CAAE,EAAE,CAAC,CAC5CT,0BAA0B,CAAGvB,IAAI,CAAC+B,IAAI,CAACE,QAAQ,CAAC,GAAG,CAAC,CAAG,KAAK,CAAG,MAAM,CACrET,YAAY,CAAGzB,UAAU,CAAG,CAAC,aAAAmC,MAAA,CAAenC,UAAU,EAAK,EAAE,CAC7D0B,WAAW,CAAGvB,WAAW,YAAAgC,MAAA,CAAchC,WAAW,EAAK,EAAE,CAAE;AACjE;AACAL,QAAQ,CACNb,WAAW,CAAC,CACVqC,GAAG,CAAHA,GAAG,CACHpB,WAAW,CAAXA,WAAW,CACXuB,YAAY,CAAZA,YAAY,CACZF,eAAe,CAAfA,eAAe,CACfC,0BAA0B,CAA1BA,0BAA0B,CAC1BE,WAAW,CAAXA,WACF,CAAC,CACH,CAAC,CAAC,wBAAAG,QAAA,CAAAO,IAAA,MAAAf,OAAA,GACH,kBAjBK,CAAAL,SAASA,CAAA,SAAAC,IAAA,CAAAoB,KAAA,MAAAC,SAAA,OAiBd,CAED;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEAlE,SAAS,CAAC,UAAM,CACd,GAAI,CAACwC,mBAAmB,CAAC2B,OAAO,CAAE,CAChCvB,SAAS,CAAC,CAAC,CACb,CACAJ,mBAAmB,CAAC2B,OAAO,CAAG,KAAK,CACrC,CAAC,CAAE,CAACvC,UAAU,CAAEC,IAAI,CAAC+B,IAAI,CAAE7B,WAAW,CAAED,WAAW,CAAC,CAAC,CAErD,GAAM,CAAAsC,SAAS,CAAGC,kBAAA,CAAI,GAAI,CAAAC,KAAK,CAAC,CAAC,CAAC,EAAEC,GAAG,CAAC,SAACC,CAAC,CAAEC,KAAK,qBAAKxD,IAAA,CAACV,QAAQ,IAAMkE,KAAQ,CAAC,GAAC,CAC/E,GAAM,CAAAC,MAAM,CAAGzC,KAAK,CAACsC,GAAG,CAAC,SAACI,IAAI,qBAAKxD,cAAA,CAACb,UAAU,CAAAsE,aAAA,CAAAA,aAAA,EAACC,KAAK,CAAE,EAAG,CAACC,KAAK,CAAE,EAAG,EAAKH,IAAI,MAAEI,GAAG,CAAEJ,IAAI,CAAChC,EAAG,EAAE,CAAC,GAAC,CAEhG,mBACEtB,KAAA,QAAK2D,SAAS,CAAC,WAAW,CAAAC,QAAA,eACxB5D,KAAA,QAAK2D,SAAS,CAAC,cAAc,CAAAC,QAAA,eAC3BhE,IAAA,CAACb,UAAU,EAACwB,UAAU,CAAEA,UAAW,CAACc,gBAAgB,CAAEA,gBAAiB,CAAE,CAAC,cAC1EzB,IAAA,CAACZ,IAAI,EAAC6E,KAAK,CAAErD,IAAK,CAAE,CAAC,EAClB,CAAC,cACNZ,IAAA,OAAI+D,SAAS,CAAC,gBAAgB,CAAAC,QAAA,CAAC,mDAAS,CAAI,CAAC,CAC5C/C,MAAM,GAAK,OAAO,cACjBb,KAAA,QAAK2D,SAAS,CAAC,qBAAqB,CAAAC,QAAA,eAClChE,IAAA,OAAAgE,QAAA,CAAI,gGAAmB,CAAI,CAAC,cAC5BhE,IAAA,MAAAgE,QAAA,CAAG,yIAAyB,CAAG,CAAC,EAC7B,CAAC,cAENhE,IAAA,QAAK+D,SAAS,CAAC,gBAAgB,CAAAC,QAAA,CAC5B/C,MAAM,GAAK,SAAS,CACnBkC,SAAS,cAETnD,IAAA,CAAAM,SAAA,EAAA0D,QAAA,CACGP,MAAM,CAACS,MAAM,CACZT,MAAM,cAENzD,IAAA,MAAGmE,KAAK,CAAE,CAAEC,YAAY,CAAE,KAAM,CAAE,CAAAJ,QAAA,CAAC,2LAAmC,CAAG,CAC1E,CACD,CACH,CACE,CACN,cACDhE,IAAA,CAACT,UAAU,EACT8E,SAAS,CAAEC,MAAM,CAACzD,WAAW,CAAE,CAC/B0D,YAAY,CAAE,SAAAA,aAACC,MAAM,QAAK,CAAA/D,QAAQ,CAACd,cAAc,CAAC6E,MAAM,CAAC,CAAC,EAAC,CAC5D,CAAC,EACC,CAAC,CAEV,CAAC,CAED,cAAe,CAAAjE,IAAI"},"metadata":{},"sourceType":"module","externalDependencies":[]}